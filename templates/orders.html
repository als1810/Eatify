{% extends "base.html" %}
{% block content %}
<h2>Orders</h2>

{% for order in orders %}
<div class="card mb-4">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <strong>Order #{{ order.order_id }}</strong> - {{ order.customer_name }} - {{ order.order_time }}
      </div>
      <div>
        <span class="badge bg-{% if order.status == 'Completed' %}success{% elif order.status == 'Pending' %}warning{% else %}secondary{% endif %}">{{ order.status }}</span>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('update_order', order_id=order.order_id) }}" class="btn btn-sm btn-outline-primary ms-2">‚úèÔ∏è Edit</a>
        <form method="POST" action="{{ url_for('delete_order', order_id=order.order_id) }}" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this order?');">üóëÔ∏è Delete</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="card-body">
    <h5>Order Items</h5>
    <table class="table table-sm table-bordered">
      <thead class="table-light">
        <tr>
          <th>Dish</th>
          <th>Restaurant</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Discount</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order['items'] %}
        <tr>
          <td>{{ item.dish_name }}</td>
          <td>{{ item.restaurant_name }}</td>
          <td>{{ item.quantity }}</td>
          <td>‚Çπ{{ "%.2f"|format(item.unit_price) }}</td>
          <td>{{ item.discount }}%</td>
          <td>‚Çπ{{ "%.2f"|format(item.unit_price * item.quantity * (1 - item.discount/100)) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    {% if order.amount %}
    <div class="mt-3">
      <strong>Total Amount: ‚Çπ{{ "%.2f"|format(order.amount) }}</strong> (Paid via {{ order.payment_type }})
    </div>
    {% else %}
    <div class="mt-3">
      <em>Payment pending</em>
      <a href="{{ url_for('pay_order', order_id=order.order_id) }}" class="btn btn-primary btn-sm ms-2">Pay Now</a>
    </div>
    {% endif %}
  </div>
</div>
{% endfor %}

{% if not orders %}
<div class="alert alert-info">No orders found.</div>
{% endif %}

<!-- Auto-refresh disabled
<script>
  // Optional auto-refresh every 10 seconds
  setTimeout(() => window.location.reload(), 10000);
</script>
-->
{% endblock %}
